---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# makehtml

<!-- badges: start -->
<!-- badges: end -->

Generic R code for producing multi-tabbed HTML output for plotted results in a specific directory. The objective is to provide a standard method for an initial presentation of extensive results from an analysis. Rmarkdown is wondferful but sometimes one just needs to review the data and the results and so needs a convenient way of viewing tables and plots. makehtml aims to provide that method.

This code is adapted and revised from code put together by Ian Taylor inside the R package __r4ss__. Essentially it creates a CSS3 file that is used by a series of HTML files, each of which represents a user defined category of results. All plots should be .png files, and all tables are derived from saved .csv files. All files, the CSS, HTML, .png and csv files are saved to a user defined directory (_resdir_), which is the main user input requirement. 


## Installation

You can install the development version from [GitHub](https://github.com/haddonm/aMSE) with:

```{r echo=TRUE, eval=FALSE}
if (!require(devtools)){install.packages("devtools")} 

devtools::install_github("https://github.com/haddonm/makehtml")

you will also need rutilsMH

devtools::install_github("https://github.com/haddonm/rutilsMH")

```

Alternatively, you can generate a branch that you can work on by cloning the repository, which, again, can be done very simply within RStudio. Open the New Project option in the project dialog at the top right of the RStudio screen and selection Version Control, then use 'https://github.com/haddonm/makehtml' in the top box, identify where you want the new directory put, and press return.

It would be a good idea to read Hadley Wickham's draft chapter on Git and GitHub at https://r-pkgs.org/index.html.


## Example

This is a basic example which illustrates the use of makehtml, though I have hashed out the final call to _make_html_ so that the RMarkdown version of the readme.md file does not generate a local website:

```{r example}
library(makehtml)
library(rutilsMH) # for plotprep and parset
starttime <- as.character(Sys.time())

# obviously you should define your own directory
indir <- "C:/Users/User/Dropbox/rcode2/makehtml/data-raw" 
resdir <- filenametopath(indir,"result")
dirExists(resdir,verbose=TRUE)
runlabel <- "runone"
resfile <- setuphtml(resdir=resdir,runname=runlabel)
# Some data
catch <- c(60913,72294,78353,91522,78288,110417,114590,76841,41965,
           50058,64094,89194,129701,160134,200340,192458,224810,183685,
           192234,138918,138623,140581)
effort <- c(5879,6295,6771,8233,6830,10488,10801,9584,5961,5930,6397,
            9377,13958,20381,23984,23013,31856,18726,31529,36423,
            24995,17806)
schaef <- as.data.frame(cbind(year=1934:1955,effort=effort,catch=catch,
                cpue=catch/effort)) # Schaefer's 1957 yellowfin data
# First save the data
filen <- filenametopath(resdir,"schaef.csv")  # csv files only
addtable(intable=schaef,filen=filen,resfile=resfile,category="data",
         caption="Schaefer's original 1957 Yellowfin Tuna fishery data.")
# sort the table on catch, just to provide two tables
filen <- filenametopath(resdir,"sortedschaef.csv")
sortyft <- schaef[order(schaef[,"catch"]),]
addtable(intable=sortyft,filen=filen,resfile=resfile,category="data",
         caption="The Schaefer 1957 data sorted on catch.")

# plot the timeseries of cpue and catch,  only png files
file <- paste0("Schaefer_Fisherydata_",runlabel,".png")
filename <- filenametopath(resdir,file) 
caption <- "The Schaefer Yellowfin tuna fishery data from 1957."
plotprep(width=7,height=4.5,filename=filename,cex=0.9,verbose=FALSE)
parset(plots=c(2,1))
ymax <- getmax(schaef$cpue)
plot(schaef$year,schaef$cpue,type="l",lwd=2,ylim=c(0,ymax),
     panel.first=grid(),xlab="",ylab="CPUE")
ymax <- getmax(schaef$catch)
plot(schaef$year,schaef$catch,type="l",lwd=2,ylim=c(0,ymax),
     panel.first=grid(),xlab="",ylab="Catch")
plotoff <- dev.off()  # don't forget this!
logfilename(filename,resfile=resfile,category="Fishery",caption)

# plot the catch against the effort
file <- paste0("Schaefer_CatchvEffort_",runlabel,".png")
filename <- filenametopath(resdir,file) 
caption <- "The Schaefer Yellowfin tuna data Catch vs Effort."
plotprep(width=7,height=3,filename=filename,cex=0.9,verbose=FALSE)
ymax <- getmax(schaef$catch)
plot(schaef$effort,schaef$catch,type="p",pch=16,cex=1.2,ylim=c(0,ymax),
     panel.first=grid(),xlab="Effort",ylab="Catch")
plotoff <- dev.off()
logfilename(filename,resfile=resfile,category="Fishery",caption)

# plot the effort data
file <- paste0("Schaefer_Effortdata_",runlabel,".png")
filename <- filenametopath(resdir,file)  #  filename=""
plotprep(width=7,height=4.5,newdev=FALSE,filename=filename,cex=0.9,
         verbose=FALSE)
ymax <- getmax(schaef$effort)
plot(schaef$year,schaef$effort,type="l",lwd=2,ylim=c(0,ymax),
     panel.first=grid(),xlab="",ylab="Effort Class 4 clipper days '000s")
plotoff <- dev.off()

caption <- "The Schaefer Yellowfin tuna effort data from 1957."
logfilename(filename,resfile=resfile,category="Effort",caption)

endtime <- as.character(Sys.time())

reportlist <- list(  #these 3 are minimal requirements for the replist
  runname=runlabel,
  starttime=starttime,endtime=endtime
)
str(reportlist,max.level = 1)

runnotes <- "This is merely to illustrate how to use the package."
# If you unhash the make_html component it will open the local 
# website generated inside resdir, if openfile=FALSE it will be 
# generated but not opened.
#
# make_html(replist=reportlist,resdir=resdir,width=500,openfile=TRUE,
#          runnotes=runnotes,verbose=FALSE,packagename="makehtml")

```


